---
- name: Load zuul return data
  set_fact:
    zuul_return_data: "{{ lookup('file', review_output_dir + '/zuul-return-data.json') | from_json }}"

- name: Count comments per file
  set_fact:
    comment_counts: "{{ zuul_return_data.zuul.file_comments | dict2items | map(attribute='value') | map('length') | list }}"

- name: Calculate total comments and files
  set_fact:
    total_comments: "{{ comment_counts | sum }}"
    total_files_with_comments: "{{ zuul_return_data.zuul.file_comments | length }}"

- name: Display inline comments summary
  debug:
    msg: |
      Inline Comments Summary:
      - Total files with comments: {{ zuul_return_data.zuul.file_comments | length }}
      - Total inline comments: {{ total_comments }}
      - Comments will be posted directly on the change files

- name: Display files with most comments
  debug:
    msg: |
      Files with most inline comments:
      {% for file_path, comments in zuul_return_data.zuul.file_comments.items() %}
      - {{ file_path }}: {{ comments | length }} comment(s)
      {% endfor %}
  when: zuul_return_data.zuul.file_comments | length > 0
