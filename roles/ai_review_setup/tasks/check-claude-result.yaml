---
# Result validation for Claude CLI executions
# Ensures the expected output file exists and provides diagnostics otherwise.

- name: "Verify {{ command_name }} output file was created"
  stat:
    path: "{{ output_file }}"
  register: ai_review_setup_output_file_stat

- name: "Check if {{ command_name }} output file exists"
  fail:
    msg: |
      Claude {{ command_name }} failed to produce expected output file
      after {{ command_result.attempts | default(1) }} attempt(s).

      Expected output file: {{ output_file }}

      Possible causes:
      - Claude CLI execution error
      - File system or directory initialization
      - LiteLLM proxy or model response
      - Network connectivity

      Command output:
      STDOUT:
      {{ command_result.stdout | default('(empty)') }}

      STDERR:
      {{ command_result.stderr | default('(empty)') }}
  when: not ai_review_setup_output_file_stat.stat.exists

- name: "Display {{ command_name }} success"
  debug:
    msg: "âœ“ {{ command_name | capitalize }} completed successfully. Output at {{ output_file }}"
  when: ai_review_setup_output_file_stat.stat.exists
