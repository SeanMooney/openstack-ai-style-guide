---
- job:
    name: openstack-ai-style-guide-lint
    parent: tox-linters
    description: |
      Run linting checks for OpenStack AI Style Guide using tox.
      Uses the linters environment which runs pre-commit with --show-diff-on-failure.
      Requires Python 3.13 for Debian opencode node compatibility.
      See docs/zuul-configuration.md for information on customizing this job.
    timeout: 900
    nodeset: debian-opencode-single-node-pod
    vars:
      tox_envlist: linters
      # Python version is pinned to 3.13 for compatibility with the debian-opencode
      # nodeset used in this Zuul CI environment. The debian-opencode nodes are
      # pre-configured with Python 3.13 and OpenCode tools. If you need to use
      # a different Python version, you may need to use a different nodeset or
      # configure the job variables. See docs/zuul-configuration.md for details.
      python_version: "3.13"

- job:
    name: teim-code-review-base
    description: |
      Base job for AI-assisted code review using Claude Code via LiteLLM.
      Uses modular Ansible roles for maintainable and reusable workflow components.
    abstract: true
    run: playbooks/teim-code-review/run.yaml
    post-run: playbooks/teim-code-review/post.yaml
    timeout: 1800
    nodeset: debian-claude-code-single-node-pod
    required-projects:
      - name: github.com/SeanMooney/openstack-ai-style-guide
        override-checkout: master
    vars:
      # Claude CLI configuration
      claude_binary: "claude"
      claude_config_dir: "{{ ansible_user_dir }}/.claude"

      # Model selection (can be overridden by child jobs)
      haiku_model: "glm-4.5-air"
      sonnet_model: "glm-4.6"
      opus_model: "glm-4.6"
      context_model: "glm-4.5-air"
      review_model: "glm-4.6"

      # Anthropic-compatible endpoint served by LiteLLM
      anthropic_api_url: "http://litellm.zuul-system.svc.cluster.local:4000"
      # NOTE: Hardcoded API key for internal homelab CI environment only.
      # This is acceptable because:
      #   - LiteLLM service is internal-only (not exposed externally)
      #   - Key has no upstream API access or billing implications
      #   - CI environment is isolated and trusted
      # IMPORTANT: Production deployments MUST use Zuul encrypted secrets.
      # Do NOT copy this pattern to environments with external access or real API keys.
      anthropic_auth_token: "sk-1234"

      # Style guide project location (Zuul provides this)
      style_guide_project: "{{ zuul.projects['github.com/SeanMooney/openstack-ai-style-guide'].src_dir }}"
      agents_source_dir: "{{ ansible_user_dir }}/{{ style_guide_project }}/agents"
      agents_target_dir: "{{ claude_config_dir }}/agents"
      style_guide_quick_rules: "{{ ansible_user_dir }}/{{ style_guide_project }}/docs/quick-rules.md"
      style_guide_comprehensive: "{{ ansible_user_dir }}/{{ style_guide_project }}/docs/comprehensive-guide.md"

      # Output configuration
      review_output_dir: "{{ ansible_user_dir }}/logs/code-review"
      context_output_file: "{{ review_output_dir }}/zuul-context.md"
      commit_summary_file: "{{ review_output_dir }}/commit-summary.md"
      commit_context_file: "{{ review_output_dir }}/commit-context.txt"
      review_report_file: "{{ review_output_dir }}/review-report.json"
      html_report_file: "{{ review_output_dir }}/review-report.html"
      zuul_comments_file: "{{ review_output_dir }}/zuul-comments.json"
      venv_dir: "{{ ansible_user_dir }}/.venv"

      extensions_to_txt:
        conf: true
        log: true
        localrc: true
        stackenv: true
        auto: true

- job:
    name: teim-code-review
    parent: teim-code-review-base
    description: |
      AI-assisted code review using Claude Code with GLM models via LiteLLM.
